<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>점검 상세 · CMMS</title>
    <link rel="stylesheet" href="../../static/assets/css/base.css" />
    <link rel="stylesheet" href="../../static/assets/css/print.css" />
  </head>
  <body>
    <div class="page">
      <header class="appbar">
        <div class="appbar-inner">
          <div class="brand">점검 관리</div>
          <div class="spacer"></div>
          <div class="meta">
            <span class="badge">memberId</span>
            <span>운영팀</span>
          </div>
        </div>
      </header>
      <nav class="breadcrumbs">
        <div class="container">
          <a th:href="@{#}" href="#">점검</a>
          <span class="sep">/</span>
          <a th:href="@{/inspection/list}">점검</a>
          <span class="sep">/</span>
          <span>상세</span>
        </div>
      </nav>
      <!-- Main Content -->
      <section data-slot-root th:fragment="content">
        <main>
        <div class="container">
          <section class="card">
            <div class="card-header">
              <div class="row" style="width:100%;justify-content:space-between">
                <div class="card-title">점검 상세</div>
                <div class="toolbar">
                  <a class="btn" th:href="@{/inspection/list}">목록</a>
                  <a class="btn" href="#" onclick="document.body.classList.add('print-preview')">출력 미리보기</a>
                  <a class="btn" href="#" onclick="window.print()">인쇄</a>
                  <a class="btn" th:href="@{/inspection/edit/{id}(id=${inspection.inspectionId})}">수정</a>
                  <button class="btn danger" 
                          th:data-delete-url="@{/inspection/delete/{id}(id=${inspection.inspectionId})}"
                          data-redirect="@{/inspection/list}"
                          data-confirm="정말 삭제하시겠습니까?">삭제</button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="section">
                <div class="section-title">기본정보</div>
                <div class="grid cols-12">
                  <div class="stack col-span-3"><div class="label">점검 번호</div><div th:text="${inspection.inspectionId}">I250101001</div></div>
                  <div class="stack col-span-9"><div class="label">점검명</div><div th:text="${inspection.name}">설비 A 정기점검</div></div>
                  <div class="stack col-span-3"><div class="label">설비 번호</div><div th:text="${inspection.plantId}">EQP000123</div></div>
                  <div class="stack col-span-3"><div class="label">작업 유형</div><div th:text="${inspection.jobId}">INSP</div></div>
                  <div class="stack col-span-3"><div class="label">Site</div><div th:text="${inspection.siteId}">SEOUL</div></div>
                  <div class="stack col-span-3"><div class="label">관리부서</div><div th:text="${inspection.deptId}">설비팀</div></div>
                </div>
              </div>

              <div class="section">
                <div class="section-title">일정 / 담당</div>
                <div class="grid cols-12">
                  <div class="stack col-span-3"><div class="label">담당자</div><div th:text="${inspection.memberId}">M0001</div></div>
                  <div class="stack col-span-3"><div class="label">계획일</div><div th:text="${inspection.plannedDate}">2025-01-10</div></div>
                  <div class="stack col-span-3"><div class="label">실적일</div><div th:text="${inspection.actualDate}">2025-01-10</div></div>
                  <div class="stack col-span-3"><div class="label">상태</div><div><span class="badge" th:text="${inspection.status == 'PLAN' ? '계획' : inspection.status == 'PROC' ? '진행' : '완료'}" 
                              th:classappend="${inspection.status == 'PLAN' ? 'badge' : inspection.status == 'PROC' ? 'badge warning' : 'badge success'}">계획</span></div></div>
                  <div class="stack col-span-12"><div class="label">비고</div><div class="muted" th:text="${inspection.note}">-</div></div>
                </div>
              </div>

              <div class="section">
                <div class="section-title">점검 항목</div>
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width:44px">#</th>
                      <th>이름</th>
                      <th>방법</th>
                      <th>최소</th>
                      <th>최대</th>
                      <th>표준</th>
                      <th>비고</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="item : ${inspection.items}" th:if="${inspection.items != null and !inspection.items.empty}">
                      <td class="cell-center" th:text="${item.lineNo}">1</td>
                      <td th:text="${item.name}">소음도 측정</td>
                      <td th:text="${item.method}">소음계 사용</td>
                      <td th:text="${item.minVal}">55</td>
                      <td th:text="${item.maxVal}">65</td>
                      <td th:text="${item.stdVal}">60</td>
                      <td th:text="${item.note}">-</td>
                    </tr>
                    <tr th:if="${inspection.items == null or inspection.items.empty}">
                      <td colspan="7" class="text-center muted">점검 항목이 없습니다.</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <div class="section-title">첨부</div>
                <table class="row-cols-3">
                  <tr>
                    <th>첨부 건수</th><td id="insp-file-count" th:text="${inspection.fileGroupId != null ? '1' : '0'}">0</td>
                    <th>비고</th><td id="insp-file-note" colspan="3" th:text="${inspection.fileGroupId != null ? '첨부파일 있음' : '-'}">-</td>
                  </tr>
                </table>
              </div>

              <!-- 출력 문서 형식 -->
              <section class="print-form" aria-hidden="true">
                <div class="doc">
                  <header class="doc-header">
                    <div class="doc-title">점검서</div>
                    <div class="doc-meta">출력일시: <span id="print-date">-</span></div>
                  </header>
                  <div class="doc-body">
                    <div class="row"><strong>점검 번호</strong><span class="spacer"></span><span th:text="${inspection.inspectionId}">I250101001</span></div>
                    <div class="row"><strong>점검명</strong><span class="spacer"></span><span th:text="${inspection.name}">설비 A 정기점검</span></div>
                    <div class="row"><strong>설비 번호</strong><span class="spacer"></span><span th:text="${inspection.plantId}">EQP000123</span></div>
                    <div class="row"><strong>계획일</strong><span class="spacer"></span><span th:text="${inspection.plannedDate}">2025-01-10</span></div>
                    <div class="row"><strong>실적일</strong><span class="spacer"></span><span th:text="${inspection.actualDate}">2025-01-10</span></div>
                    <div class="row"><strong>상태</strong><span class="spacer"></span><span th:text="${inspection.status == 'PLAN' ? '계획' : inspection.status == 'PROC' ? '진행' : '완료'}">계획</span></div>
                  </div>
                </div>
              </section>
            </div>
          </section>
        </div>
        </main>
      </section>
      <footer>
        <div class="container">© 점검 관리</div>
      </footer>
    </div>
    <script src="../../static/assets/js/app.js"></script>
    <script>
      (function() {
        var d = new Date();
        var z = function(n){ return (n<10? ('0'+n) : n); };
        var ts = d.getFullYear() + '-' + z(d.getMonth()+1) + '-' + z(d.getDate()) + ' ' + z(d.getHours()) + ':' + z(d.getMinutes());
        var el = document.getElementById('print-date');
        if (el) el.textContent = ts;
        window.addEventListener('afterprint', function() { document.body.classList.remove('print-preview'); });
        document.addEventListener('keydown', function(e){ if (e.key==='Escape') document.body.classList.remove('print-preview'); });
      })();
    </script>
  </body>
  </html>
